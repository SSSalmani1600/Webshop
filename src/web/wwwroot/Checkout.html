<!DOCTYPE html>
<html lang="nl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Afrekenen</title>
  <link rel="stylesheet" href="./assets/css/Checkout.css">
</head>
<body>
  <main class="checkout-container">
    <section class="checkout-left">
      <h2>Afrekenen</h2>

      <div class="checkout-section">
        <h3>Verzendadres</h3>
        <form id="adresForm">
          <label>Naam <span class="required">*</span></label>
          <input type="text" name="naam" placeholder="Naam" required>

          <label>Straat + Huisnummer <span class="required">*</span></label>
          <input type="text" name="straat_huisnummer" placeholder="Straat + Huisnummer" required>

          <label>Postcode + Plaats <span class="required">*</span></label>
          <input type="text" name="postcode_plaats" placeholder="Postcode + Plaats" required>

          <label>Telefoonnummer <span class="required">*</span></label>
          <input type="text" name="telefoonnummer" placeholder="Telefoonnummer" required>

          <button type="submit" class="checkout-btn">Bestelling plaatsen</button>
        </form>
      </div>
    </section>

    <aside class="checkout-summary">
      <h3>Winkelwagen</h3>
      <div class="summary-item">
        <div>
          <p>Productnaam</p>
          <p>€0,00</p>
        </div>
      </div>
      <hr>
      <div class="summary-total">
        <p>Subtotaal: €0,00</p>
        <p>Verzendkosten: €0,00</p>
        <p><strong>Totaal: €0,00</strong></p>
      </div>
    </aside>
  </main>

  <script>
    const form = document.getElementById("adresForm");

    form.addEventListener("submit", async (e) => {
      e.preventDefault();

      const formData = new FormData(form);
      const payload = {
        naam: formData.get("naam"),
        straat_huisnummer: formData.get("straat_huisnummer"),
        postcode_plaats: formData.get("postcode_plaats"),
        telefoonnummer: formData.get("telefoonnummer"),
      };

      try {
        const response = await fetch("http://localhost:3001/address", {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
          },
          credentials: "include", // ✅ stuur sessiecookie mee
          body: JSON.stringify(payload),
        });

        if (response.ok) {
          alert("Adres succesvol opgeslagen!");
          // window.location.href = "/bedankt.html"; // optioneel redirect
        } else {
          const err = await response.json();
          alert("Fout: " + err.error);
        }
      } catch (error) {
        console.error("Fout bij verzenden:", error);
        alert("Er ging iets mis bij het opslaan.");
      }
    });
  </script>
</body>
</html>
