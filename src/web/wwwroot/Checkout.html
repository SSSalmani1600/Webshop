<!DOCTYPE html>
<html lang="nl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Afrekenen</title>
  <link rel="stylesheet" href="./assets/css/Checkout.css">
</head>
<body>
  <main class="checkout-container">
    <section class="checkout-left">
      <h2>Afrekenen</h2>

      <div class="checkout-section">
        <h3>Verzendadres</h3>
        <form id="adresForm">
          <label>Naam <span class="required">*</span></label>
          <input type="text" name="naam" placeholder="Naam" required>

          <label>Straat + Huisnummer <span class="required">*</span></label>
          <input type="text" name="straat_huisnummer" placeholder="Straat + Huisnummer" required>

          <label>Postcode + Plaats <span class="required">*</span></label>
          <input type="text" name="postcode_plaats" placeholder="Postcode + Plaats" required>

          <label>Telefoonnummer <span class="required">*</span></label>
          <input type="text" name="telefoonnummer" placeholder="Telefoonnummer" required>

          <button type="submit" class="checkout-btn">Bestelling plaatsen</button>
        </form>
      </div>
    </section>

    <aside class="checkout-summary">
      <h3>Winkelwagen</h3>
      <div class="summary-item">
        <div>
          <p>Productnaam</p>
          <p>€0,00</p>
        </div>
      </div>
      <hr>
      <div class="summary-total">
        <p>Subtotaal: €0,00</p>
        <p>Verzendkosten: €0,00</p>
        <p><strong>Totaal: €0,00</strong></p>
      </div>
    </aside>
  </main>

  <script>
  document.getElementById("adresForm").addEventListener("submit", async function (event) {
    event.preventDefault();

    const userId = 1; // ← tijdelijk hardcoded, vervang met echte user info

    const formData = new FormData(event.target);
    const data = {
      userId: userId,
      naam: formData.get("naam"),
      straatHuisnummer: formData.get("straat_huisnummer"),
      postcodePlaats: formData.get("postcode_plaats"),
      telefoonnummer: formData.get("telefoonnummer"),
    };

    try {
      const res = await fetch("http://localhost:3001/checkout", {
        method: "POST",
        headers: {
          "Content-Type": "application/json"
        },
        credentials: "include",
        body: JSON.stringify(data)
      });

      if (!res.ok) throw new Error("Kon adres niet opslaan");

      const result = await res.json();
      alert("Adres opgeslagen! Adres ID: " + result.addressId);

      // Optioneel: doorgaan naar volgende stap, bijv. order plaatsen
    } catch (err) {
      console.error(err);
      alert("Er is een fout opgetreden tijdens het opslaan van het adres.");
    }
  });
</script>

</body>
</html>
